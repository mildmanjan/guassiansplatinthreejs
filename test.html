<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Single Portal</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        #info {
            position: fixed;
            top: 20px;
            left: 20px;
            color: white;
            background: rgba(0,0,0,0.8);
            padding: 20px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div id="info">Loading test portal...</div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import * as GaussianSplats3D from 'https://cdn.jsdelivr.net/npm/@mkkellogg/gaussian-splats-3d@latest/build/gaussian-splats-3d.module.min.js';

        const info = document.getElementById('info');
        
        function log(msg) {
            console.log(msg);
            info.innerHTML += '<br>' + msg;
        }

        // Scene setup
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0a0a0a);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 0, 5);

        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const controls = new OrbitControls(camera, renderer.domElement);

        // Add basic lighting
        scene.add(new THREE.AmbientLight(0xffffff, 0.5));

        // Add reference cube
        const cube = new THREE.Mesh(
            new THREE.BoxGeometry(1, 1, 1),
            new THREE.MeshBasicMaterial({ color: 0xff0000, wireframe: true })
        );
        cube.position.set(-3, 0, 0);
        scene.add(cube);

        log('üî∑ Scene setup complete');
        log(`üìä Scene has ${scene.children.length} children`);

        // Load Gaussian Splat
        async function loadSplat() {
            try {
                log('üìÑ Creating viewer...');
                
                const viewer = new GaussianSplats3D.Viewer({
                    threeScene: scene,
                    renderer: renderer,
                    camera: camera,
                    selfDrivenMode: false,
                    useBuiltInControls: false,
                    gpuAcceleratedSort: false,
                    integerBasedSort: false,
                    sharedMemoryForWorkers: false,
                    enableSplatSorting: true,
                    renderMode: GaussianSplats3D.RenderMode.Always,
                    logLevel: GaussianSplats3D.LogLevel.Info
                });

                log('‚úÖ Viewer created');

                await viewer.init();
                log('‚úÖ Viewer initialized');

                const splatUrl = 'https://huggingface.co/mysterytreebeast/gaussian-splat-models/resolve/main/InteriorDesign.ply';
                log(`üì• Loading: ${splatUrl}`);

                await viewer.addSplatScene(splatUrl, {
                    progressiveLoad: true,
                    splatAlphaRemovalThreshold: 5,
                    position: [3, 0, 0],  // Position to the right
                    rotation: [1, 0, 0, 0],
                    scale: [1, 1, 1]
                });

                log('‚úÖ Splat loaded!');
                log(`üìä Scene now has ${scene.children.length} children`);

                // List all objects
                scene.traverse((obj) => {
                    log(`   - ${obj.type} at (${obj.position.x.toFixed(1)}, ${obj.position.y.toFixed(1)}, ${obj.position.z.toFixed(1)})`);
                });

                // Animation loop
                function animate() {
                    requestAnimationFrame(animate);
                    controls.update();
                    viewer.update();
                    viewer.render();
                    renderer.render(scene, camera);
                }
                animate();

            } catch (error) {
                log('‚ùå ERROR: ' + error.message);
                console.error(error);
            }
        }

        loadSplat();
    </script>
</body>
</html>